
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ApnsPHP - 陈斌彬的技术博客</title>
  <meta name="author" content="陈斌彬">

  
  <meta name="description" content="ApnsPHP: Apple Push Notification &amp; Feedback Provider A full set of open source PHP classes to interact with the Apple Push Notification service &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cnbin.github.io/blog/2015/11/24/apnsphp/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="陈斌彬的技术博客" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">陈斌彬的技术博客</a></h1>
  
    <h2>Stay foolish,stay hungry</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="cnbin.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation"> 
  <li><a href="/">首页</a></li> 
  <li><a href="/blog/archives">归档</a></li> 
  <li><a href="/about">关于</a></li> 
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ApnsPHP</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-24T10:04:11+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:04 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><!--More-->


<h1><img src="http://immobiliare.github.io/ApnsPHP/images/logo.png" width="48"> ApnsPHP: Apple Push Notification &amp; Feedback Provider</h1>

<p align="center">
    <img src="https://poser.pugx.org/duccio/apns-php/downloads">
    <img src="https://poser.pugx.org/duccio/apns-php/d/monthly">
    <img src="https://poser.pugx.org/duccio/apns-php/d/daily">
    <img src="https://poser.pugx.org/duccio/apns-php/license">
</p>


<p>A <strong>full set</strong> of <em>open source</em> PHP classes to interact with the <strong>Apple Push Notification service</strong> for the iPhone, iPad and the iPod Touch.</p>

<ul>
<li><a href="sample_push.php">Sample PHP Push code</a></li>
<li><a href="sample_feedback.php">Sample PHP Feedback code</a></li>
<li><a href="sample_server.php">Sample PHP Server code</a></li>
<li><a href="Objective-C%20Demo/">Sample Objective-C device code</a></li>
<li><a href="http://immobiliare.github.io/ApnsPHP/html/index.html">Full APIs Documentation</a></li>
<li><a href="Doc/CertificateCreation.md">How to generate a Push Notification certificate and download the Entrust Root Authority certificate</a></li>
</ul>


<h2>News</h2>

<ul>
<li><strong>September 29, 2015</strong>, Some stats on this README.md, thanks <a href="https://poser.pugx.org">Badge Poser</a>.</li>
<li><strong>May 12, 2015</strong>, ApnsPHP has been moved to the <a href="https://github.com/immobiliare">Immobiliare Labs</a> organization on github.</li>
<li><strong>May 07, 2015</strong>, ApnsPHP has increased the default payload size to 2048 and is now using the TLS protocol by default instead of the old SSL. News from Apple: <a href="https://developer.apple.com/news/?id=10222014a">https://developer.apple.com/news/?id=10222014a</a></li>
<li><strong>October 26, 2012</strong>, Project source code has moved to <a href="https://github.com/immobiliare/ApnsPHP">github</a>.</li>
<li><strong>June 18, 2011</strong>, Please, use <a href="https://groups.google.com/group/apns-php">ApnsPHP Google Group</a> for help requests or to discuss about this project. To report an issue use <a href="https://github.com/immobiliare/ApnsPHP/issues">Issues</a>. Thanks!</li>
<li><strong>December 18, 2010</strong>, Full APNs message support: message body, localized action button, localized message with arguments substitution and custom launch images.</li>
<li><strong>December 15, 2010</strong>, Committed the first version of the Objective-C Demo Project with not-running, running in foreground and running in background application state support.</li>
<li><strong>December 14, 2010</strong>, Added the support for multiple Custom Property.</li>
<li><strong>August 28, 2010</strong>, Added support for the new APNs enhanced format that addresses some of the issues with the simple format: <em>Notification expiry</em> and <em>Error response</em>.</li>
<li><strong>February 28, 2010</strong>, ApnsPHP Source Code is now available.</li>
</ul>


<h2>Packagist</h2>

<p><a href="https://packagist.org/packages/duccio/apns-php">https://packagist.org/packages/duccio/apns-php</a></p>

<p>Thanks @jbender!</p>

<h2>Architecture</h2>

<ul>
<li><strong>Autoload system</strong>, explicitly include only Autoload.php and all classes are loaded on-demand.</li>
<li><strong>Message class</strong>, to build a notification payload.</li>
<li><strong>Push class</strong>, to push one or more messages to Apple Push Notification service.</li>
<li><strong>Feedback class</strong>, to query the Apple Feedback service to get the list of broken device tokens.</li>
<li><strong>Push Server class</strong>, to create a Push Server with one or more (forked) processes reading from a common message queue.</li>
<li><strong>Log class/interface</strong>, to log to standard output or for custom logging purpose.</li>
<li><strong>Objective-C Demo Project</strong> with not-running, running in foreground and running in background application state support.</li>
</ul>


<h2>Classes hierarchy</h2>

<p><img src="http://immobiliare.github.io/ApnsPHP/images/classes1.png" alt="" />
<img src="http://immobiliare.github.io/ApnsPHP/images/classes2.png" alt="" />
<img src="http://immobiliare.github.io/ApnsPHP/images/classes3.png" alt="" /></p>

<h2>Details</h2>

<p>In the Apple Push Notification Binary protocol there isn&rsquo;t a real-time feedback about the correctness of notifications pushed to the server. So, after each write to the server, the Push class waits for the &ldquo;read stream&rdquo; to change its status (or at least N microseconds); if it happened and the client socket receives an &ldquo;end-of-file&rdquo; from the server, the notification pushed to the server was broken, the Apple server has closed the connection and the client needs to reconnect to send other notifications still on the message queue.</p>

<p>To speed-up the sending activities the Push Server class can be used to create a Push Notification Server with many processes that reads a common message queue and sends parallel Push Notifications.</p>

<p>All client-server activities are based on the &ldquo;on error, retry&rdquo; pattern with customizable timeouts, retry times and retry intervals.</p>

<h2>Requirements</h2>

<p>PHP 5.3.0 or later with OpenSSL, PCNTL, System V shared memory and semaphore support.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./configure --with-openssl[=PATH] --enable-pcntl --enable-sysvshm --enable-sysvsem</span></code></pre></td></tr></table></div></figure>


<p>If you plan to use only Push and Feedback provider without the Server part you need only OpenSSL (no PCNTL, System V shared memory or semaphore):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./configure --with-openssl[=PATH]</span></code></pre></td></tr></table></div></figure>


<p><em>Usually OpenSSL is built-in in standard PHP Linux distributions packages.
Standard PHP 5.3.0 shipped with Mac OS X Snow Leopard just works.</em></p>

<h2>Please&hellip;</h2>

<p>&hellip; drop a line if you use ApnsPHP for your published application on the App Store! Thanks :-)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">陈斌彬</span></span>

      




<time class='entry-date' datetime='2015-11-24T10:04:11+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:04 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ios/'>ios</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/11/24/c-number-zhong-varguan-jian-zi-shi-yong/" title="Previous Post: C#中var关键字使用">&laquo; C#中var关键字使用</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/11/24/node-apn/" title="Next Post: node-apn">node-apn &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section> 
  <h1>文章分类</h1> 
  <ul id="categories"> 
    <li class='category'><a href='/blog/categories/android/'>android (126)</a></li>
<li class='category'><a href='/blog/categories/computer/'>computer (158)</a></li>
<li class='category'><a href='/blog/categories/csharp/'>csharp (56)</a></li>
<li class='category'><a href='/blog/categories/energy/'>energy (17)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (15)</a></li>
<li class='category'><a href='/blog/categories/github/'>github (2)</a></li>
<li class='category'><a href='/blog/categories/ionic/'>ionic (16)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (735)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (23)</a></li>
<li class='category'><a href='/blog/categories/js/'>js (143)</a></li>
<li class='category'><a href='/blog/categories/life/'>life (126)</a></li>
<li class='category'><a href='/blog/categories/linux/'>linux (63)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (71)</a></li>
<li class='category'><a href='/blog/categories/net/'>net (417)</a></li>
<li class='category'><a href='/blog/categories/network/'>network (2)</a></li>
<li class='category'><a href='/blog/categories/objective-c/'>objective-c (78)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (4)</a></li>
<li class='category'><a href='/blog/categories/php/'>php (24)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (5)</a></li>
<li class='category'><a href='/blog/categories/react/'>react (5)</a></li>
<li class='category'><a href='/blog/categories/ruby/'>ruby (23)</a></li>
<li class='category'><a href='/blog/categories/sql/'>sql (8)</a></li>
<li class='category'><a href='/blog/categories/swift/'>swift (40)</a></li>
<li class='category'><a href='/blog/categories/video/'>video (1)</a></li>
<li class='category'><a href='/blog/categories/web/'>web (185)</a></li>
  
    </ul> 
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/11/iosyu-webjiao-hu/">Ios与web交互</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/11/ionishang-chuan-www/">Ionic上传 Www</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/10/ru-he-wei-swiftjin-xing-hong-ding-yi/">如何为Swift进行宏定义</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/10/oc-diao-yong-swift/">Oc 调用 Swift（原创）</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/09/ocyu-swiftxiang-hu-diao-yong/">OC与swift相互调用</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - 陈斌彬 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
