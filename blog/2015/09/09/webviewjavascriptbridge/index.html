
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>WebViewJavascriptBridge - 陈斌彬的技术博客</title>
  <meta name="author" content="陈斌彬">

  
  <meta name="description" content="An iOS/OSX bridge for sending messages between Obj-C and JavaScript in UIWebViews/WebViews. If you like WebViewJavascriptBridge you may also want to &hellip;">
  <meta name="keywords" content="webviewjavascriptbridge">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cnbin.github.io/blog/2015/09/09/webviewjavascriptbridge/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="陈斌彬的技术博客" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">陈斌彬的技术博客</a></h1>
  
    <h2>Stay foolish,stay hungry</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="cnbin.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation"> 
  <li><a href="/">首页</a></li> 
  <li><a href="/blog/archives">归档</a></li> 
  <li><a href="/about">关于</a></li> 
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">WebViewJavascriptBridge</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-09T08:40:11+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:40 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><!--More-->


<p>An iOS/OSX bridge for sending messages between Obj-C and JavaScript in UIWebViews/WebViews.</p>

<p>If you like WebViewJavascriptBridge you may also want to check out <a href="https://github.com/marcuswestin/WebViewProxy">WebViewProxy</a>.</p>

<h2>In the Wild</h2>

<p>WebViewJavascriptBridge is used by a range of companies and projects. This list is incomplete, but feel free to add your&rsquo;s and send a PR.</p>

<ul>
<li><a href="https://www.facebook.com/mobile/messenger">Facebook Messenger</a></li>
<li><a href="https://facebook.com/paper">Facebook Paper</a></li>
<li><a href="https://www.getyardsale.com/">Yardsale</a></li>
<li><a href="http://www.evertrue.com/">EverTrue</a></li>
<li><a href="http://www.game-insight.com/">Game Insight</a></li>
<li><a href="http://www.altralogica.it">Altralogica</a></li>
<li><a href="http://www.sush.io">Sush.io</a></li>
<li>Flutterby Labs</li>
<li>JD Media&rsquo;s <a href="https://itunes.apple.com/us/app/ding-sheng-zhong-hua/id537273940?mt=8">鼎盛中华</a></li>
<li>Dojo4&rsquo;s <a href="http://dojo4.github.io/imbed/">Imbed</a></li>
<li><a href="https://carezone.com">CareZone</a></li>
<li><a href="http://www.hemlig.co">Hemlig</a></li>
<li><a href="https://fril.jp">FRIL</a></li>
</ul>


<h2>Setup &amp; Examples (iOS &amp; OSX)</h2>

<p>Start with the Example Apps/ folder. Open either the iOS or OSX project and hit run to see it in action.</p>

<p>To use a WebViewJavascriptBridge in your own project:</p>

<p>1) Drag the <code>WebViewJavascriptBridge</code> folder into your project.</p>

<ul>
<li>In the dialog that appears, uncheck &ldquo;Copy items into destination group&rsquo;s folder&rdquo; and select &ldquo;Create groups for any folders&rdquo;</li>
</ul>


<p>2) Import the header file and declare an ivar property:</p>

<pre><code>#import "WebViewJavascriptBridge.h"
</code></pre>

<p>&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span> <span class="n">WebViewJavascriptBridge</span><span class="o">*</span> <span class="n">bridge</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>3) Instantiate WebViewJavascriptBridge with a UIWebView (iOS) or WebView (OSX):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="o">=</span> <span class="p">[</span><span class="n">WebViewJavascriptBridge</span> <span class="nl">bridgeForWebView</span><span class="p">:</span><span class="n">webView</span> <span class="nl">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">data</span><span class="p">,</span> <span class="n">WVJBResponseCallback</span> <span class="n">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Received message from javascript: %@&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
</span><span class='line'>  <span class="n">responseCallback</span><span class="p">(</span><span class="s">@&quot;Right back atcha&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>4) Go ahead and send some messages from ObjC to javascript:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">send</span><span class="p">:</span><span class="s">@&quot;Well hello there&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">send</span><span class="p">:[</span><span class="bp">NSDictionary</span> <span class="nl">dictionaryWithObject</span><span class="p">:</span><span class="s">@&quot;Foo&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;Bar&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">send</span><span class="p">:</span><span class="s">@&quot;Give me a response, will you?&quot;</span> <span class="nl">responseCallback</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">responseData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;ObjC got its response! %@&quot;</span><span class="p">,</span> <span class="n">responseData</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>4) Finally, set up the javascript side:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">connectWebViewJavascriptBridge</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">WebViewJavascriptBridge</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">callback</span><span class="p">(</span><span class="nx">WebViewJavascriptBridge</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;WebViewJavascriptBridgeReady&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">callback</span><span class="p">(</span><span class="nx">WebViewJavascriptBridge</span><span class="p">)</span>
</span><span class='line'>      <span class="p">},</span> <span class="kc">false</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">connectWebViewJavascriptBridge</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">bridge</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/* Init your app here */</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">bridge</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Received message: &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">responseCallback</span><span class="p">(</span><span class="s2">&quot;Right back atcha&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'>  <span class="nx">bridge</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hello from the javascript&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">bridge</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Please respond to this&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">responseCallback</span><span class="p">(</span><span class="nx">responseData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Javascript got its response&quot;</span><span class="p">,</span> <span class="nx">responseData</span><span class="p">)</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h2>WKWebView Support (iOS 8 &amp; OS 10.10)</h2>

<p>WARNING: WKWebView still has <a href="https://github.com/ShingoFukuyama/WKWebViewTips/blob/master/README.md">many bugs and missing network APIs.</a> It may not be a simple drop-in replacement.</p>

<p>WebViewJavascriptBridge supports <a href="http://nshipster.com/wkwebkit/">WKWebView</a> for iOS 8 and OSX Yosemite. In order to use WKWebView you need to instantiate the <code>WKWebViewJavascriptBridge</code>. The rest of the <code>WKWebViewJavascriptBridge</code> API is the same as <code>WebViewJavascriptBridge</code>.</p>

<p>1) Import the header file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;WKWebViewJavascriptBridge.h&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>2) Instantiate WKWebViewJavascriptBridge and with a WKWebView object</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">WKWebViewJavascriptBridge</span><span class="o">*</span> <span class="n">bridge</span> <span class="o">=</span> <span class="p">[</span><span class="n">WKWebViewJavascriptBridge</span> <span class="nl">bridgeForWebView</span><span class="p">:</span><span class="n">webView</span> <span class="nl">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">data</span><span class="p">,</span> <span class="n">WVJBResponseCallback</span> <span class="n">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Received message from javascript: %@&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
</span><span class='line'>  <span class="n">responseCallback</span><span class="p">(</span><span class="s">@&quot;Right back atcha&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Contributors &amp; Forks</h2>

<p>Contributors: <a href="https://github.com/marcuswestin/WebViewJavascriptBridge/graphs/contributors">https://github.com/marcuswestin/WebViewJavascriptBridge/graphs/contributors</a></p>

<p>Forks: <a href="https://github.com/marcuswestin/WebViewJavascriptBridge/network/members">https://github.com/marcuswestin/WebViewJavascriptBridge/network/members</a></p>

<h2>API Reference</h2>

<h3>ObjC API</h3>

<h5><code>[WebViewJavascriptBridge bridgeForWebView:(UIWebView/WebView*)webview handler:(WVJBHandler)handler]</code></h5>

<h5><code>[WebViewJavascriptBridge bridgeForWebView:(UIWebView/WebView*)webview webViewDelegate:(UIWebViewDelegate*)webViewDelegate handler:(WVJBHandler)handler]</code></h5>

<p>Create a javascript bridge for the given web view.</p>

<p>The <code>WVJBResponseCallback</code> will not be <code>nil</code> if the javascript expects a response.</p>

<p>Optionally, pass in <code>webViewDelegate:(UIWebViewDelegate*)webViewDelegate</code> if you need to respond to the <a href="http://developer.apple.com/library/ios/documentation/uikit/reference/UIWebViewDelegate_Protocol/Reference/Reference.html">web view&rsquo;s lifecycle events</a>.</p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">WebViewJavascriptBridge</span> <span class="nl">bridgeForWebView</span><span class="p">:</span><span class="n">webView</span> <span class="nl">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">data</span><span class="p">,</span> <span class="n">WVJBResponseCallback</span> <span class="n">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Received message from javascript: %@&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">responseCallback</span><span class="p">(</span><span class="s">@&quot;Right back atcha&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}]</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">WebViewJavascriptBridge</span> <span class="nl">bridgeForWebView</span><span class="p">:</span><span class="n">webView</span> <span class="nl">webViewDelegate</span><span class="p">:</span><span class="nb">self</span> <span class="nl">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">data</span><span class="p">,</span> <span class="n">WVJBResponseCallback</span> <span class="n">responseCallback</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h5><code>[bridge send:(id)data]</code></h5>

<h5><code>[bridge send:(id)data responseCallback:(WVJBResponseCallback)responseCallback]</code></h5>

<p>Send a message to javascript. Optionally expect a response by giving a <code>responseCallback</code> block.</p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">send</span><span class="p">:</span><span class="s">@&quot;Hi&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">send</span><span class="p">:[</span><span class="bp">NSDictionary</span> <span class="nl">dictionaryWithObject</span><span class="p">:</span><span class="s">@&quot;Foo&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;Bar&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">send</span><span class="p">:</span><span class="s">@&quot;I expect a response!&quot;</span> <span class="nl">responseCallback</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">responseData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Got response! %@&quot;</span><span class="p">,</span> <span class="n">responseData</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h5><code>[bridge registerHandler:(NSString*)handlerName handler:(WVJBHandler)handler]</code></h5>

<p>Register a handler called <code>handlerName</code>. The javascript can then call this handler with <code>WebViewJavascriptBridge.callHandler("handlerName")</code>.</p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">registerHandler</span><span class="p">:</span><span class="s">@&quot;getScreenHeight&quot;</span> <span class="nl">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">data</span><span class="p">,</span> <span class="n">WVJBResponseCallback</span> <span class="n">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">responseCallback</span><span class="p">([</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">].</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">]);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h5><code>[bridge callHandler:(NSString*)handlerName data:(id)data]</code></h5>

<h5><code>[bridge callHandler:(NSString*)handlerName data:(id)data responseCallback:(WVJBResponseCallback)callback]</code></h5>

<p>Call the javascript handler called <code>handlerName</code>. Optionally expect a response by giving a <code>responseCallback</code> block.</p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">callHandler</span><span class="p">:</span><span class="s">@&quot;showAlert&quot;</span> <span class="nl">data</span><span class="p">:</span><span class="s">@&quot;Hi from ObjC to JS!&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span> <span class="nl">callHandler</span><span class="p">:</span><span class="s">@&quot;getCurrentPageUrl&quot;</span> <span class="nl">data</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">responseCallback</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">responseData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Current UIWebView page URL is: %@&quot;</span><span class="p">,</span> <span class="n">responseData</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Custom bundle</h4>

<p><code>WebViewJavascriptBridge</code> requires <code>WebViewJavascriptBridge.js.txt</code> file that is injected into web view to create a bridge on JS side. Standard implementation uses <code>mainBundle</code> to search for this file. If you e.g. build a static library and you have that file placed somewhere else you can use this method to specify which bundle should be searched for <code>WebViewJavascriptBridge.js.txt</code> file:</p>

<h5><code>[WebViewJavascriptBridge bridgeForWebView:(UIWebView/WebView*)webView webViewDelegate:(UIWebViewDelegate*)webViewDelegate handler:(WVJBHandler)handler resourceBundle:(NSBundle*)bundle</code></h5>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">WebViewJavascriptBridge</span> <span class="nl">bridgeForWebView</span><span class="p">:</span><span class="n">_webView</span>
</span><span class='line'>                          <span class="nl">webViewDelegate</span><span class="p">:</span><span class="nb">self</span>
</span><span class='line'>                                  <span class="nl">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">data</span><span class="p">,</span> <span class="n">WVJBResponseCallback</span> <span class="n">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                                      <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Received message from javascript: %@&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
</span><span class='line'>                                  <span class="p">}</span>
</span><span class='line'>                           <span class="nl">resourceBundle</span><span class="p">:[</span><span class="bp">NSBundle</span> <span class="nl">bundleWithURL</span><span class="p">:[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">URLForResource</span><span class="p">:</span><span class="s">@&quot;ResourcesBundle&quot;</span> <span class="nl">withExtension</span><span class="p">:</span><span class="s">@&quot;bundle&quot;</span><span class="p">]]</span>
</span><span class='line'><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Javascript API</h3>

<h5><code>document.addEventListener('WebViewJavascriptBridgeReady', function onBridgeReady(event) { ... }, false)</code></h5>

<p>Always wait for the <code>WebViewJavascriptBridgeReady</code> DOM event.</p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;WebViewJavascriptBridgeReady&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">bridge</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">bridge</span>
</span><span class='line'>  <span class="c1">// Start using the bridge</span>
</span><span class='line'><span class="p">},</span> <span class="kc">false</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h5><code>bridge.init(function messageHandler(data, response) { ... })</code></h5>

<p>Initialize the bridge. This should be called inside of the <code>'WebViewJavascriptBridgeReady'</code> event handler.</p>

<p>The <code>messageHandler</code> function will receive all messages sent from ObjC via <code>[bridge send:(id)data]</code> and <code>[bridge send:(id)data responseCallback:(WVJBResponseCallback)responseCallback]</code>.</p>

<p>The <code>response</code> object will be defined if if ObjC sent the message with a <code>WVJBResponseCallback</code> block.</p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">bridge</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Got data &quot;</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">responseCallback</span><span class="p">(</span><span class="s2">&quot;Right back atcha!&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h5><code>bridge.send("Hi there!")</code></h5>

<h5><code>bridge.send({ Foo:"Bar" })</code></h5>

<h5><code>bridge.send(data, function responseCallback(responseData) { ... })</code></h5>

<p>Send a message to ObjC. Optionally expect a response by giving a <code>responseCallback</code> function.</p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">bridge</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hi there!&quot;</span><span class="p">)</span>
</span><span class='line'><span class="nx">bridge</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hi there!&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">responseData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;I got a response! &quot;</span><span class="o">+</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">responseData</span><span class="p">))</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h5><code>bridge.registerHandler("handlerName", function(responseData) { ... })</code></h5>

<p>Register a handler called <code>handlerName</code>. The ObjC can then call this handler with <code>[bridge callHandler:"handlerName" data:@"Foo"]</code> and <code>[bridge callHandler:"handlerName" data:@"Foo" responseCallback:^(id responseData) { ... }]</code></p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">bridge</span><span class="p">.</span><span class="nx">registerHandler</span><span class="p">(</span><span class="s2">&quot;showAlert&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">})</span>
</span><span class='line'><span class="nx">bridge</span><span class="p">.</span><span class="nx">registerHandler</span><span class="p">(</span><span class="s2">&quot;getCurrentPageUrl&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">responseCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">responseCallback</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h2>iOS4 support (with JSONKit)</h2>

<p><em>Note</em>: iOS4 support has not yet been tested in v2+.</p>

<p>WebViewJavascriptBridge uses <code>NSJSONSerialization</code> by default. If you need iOS 4 support then you can use <a href="https://github.com/johnezang/JSONKit/">JSONKit</a>, and add <code>USE_JSONKIT</code> to the preprocessor macros for your project.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">陈斌彬</span></span>

      




<time class='entry-date' datetime='2015-09-09T08:40:11+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:40 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ios/'>ios</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/09/09/nanoc/" title="Previous Post: nanoc">&laquo; nanoc</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/09/09/github-qian-10000ming-pai-xing-bang/" title="Next Post: Github 前1000名排行榜">Github 前1000名排行榜 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section> 
  <h1>文章分类</h1> 
  <ul id="categories"> 
    <li class='category'><a href='/blog/categories/android/'>android (126)</a></li>
<li class='category'><a href='/blog/categories/angular2/'>angular2 (2)</a></li>
<li class='category'><a href='/blog/categories/computer/'>computer (158)</a></li>
<li class='category'><a href='/blog/categories/csharp/'>csharp (56)</a></li>
<li class='category'><a href='/blog/categories/energy/'>energy (17)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (15)</a></li>
<li class='category'><a href='/blog/categories/github/'>github (2)</a></li>
<li class='category'><a href='/blog/categories/ionic/'>ionic (23)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (741)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (23)</a></li>
<li class='category'><a href='/blog/categories/js/'>js (143)</a></li>
<li class='category'><a href='/blog/categories/life/'>life (126)</a></li>
<li class='category'><a href='/blog/categories/linux/'>linux (63)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (71)</a></li>
<li class='category'><a href='/blog/categories/net/'>net (417)</a></li>
<li class='category'><a href='/blog/categories/network/'>network (2)</a></li>
<li class='category'><a href='/blog/categories/objective-c/'>objective-c (78)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (4)</a></li>
<li class='category'><a href='/blog/categories/php/'>php (24)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (5)</a></li>
<li class='category'><a href='/blog/categories/react/'>react (5)</a></li>
<li class='category'><a href='/blog/categories/ruby/'>ruby (23)</a></li>
<li class='category'><a href='/blog/categories/sql/'>sql (8)</a></li>
<li class='category'><a href='/blog/categories/swift/'>swift (40)</a></li>
<li class='category'><a href='/blog/categories/typescript/'>typescript (1)</a></li>
<li class='category'><a href='/blog/categories/video/'>video (1)</a></li>
<li class='category'><a href='/blog/categories/vue/'>vue (2)</a></li>
<li class='category'><a href='/blog/categories/web/'>web (185)</a></li>
  
    </ul> 
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/30/iosruo-wang-ce-shi-gong-ju-network-link-conditione/">IOS弱网测试工具 Network Link Conditione</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/30/guan-yu-angular2de-xie-zi-liao-chi-xu-geng-xin-zhong-/">关于Angular2的一些资料（持续更新中）</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/30/angular2-yin-xiang/">Angular2 印象</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/30/ionic-2-10fen-zhong-hello-wordjiao-cheng/">Ionic 2 - 10分钟Hello Word教程</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/30/typescript-zhong-de-export-he-import/">TypeScript 中的 Export 和 Import</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - 陈斌彬 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
